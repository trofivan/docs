import Doc from '~/components/layout/docs'
import { TerminalInput } from '~/components/text/terminal'
import { Code, InlineCode } from '~/components/text/code'
import { GenericLink } from '~/components/text/link'
import { Image } from '~/components/media'
import Caption from '~/components/text/caption'
import Note from '~/components/text/note'
import Example from '~/components/example'
import Tag from '~/components/text/tag'
import Card from '~/components/card'

export const meta = {
  title: 'WordPress Builder (@now/wordpress)',
  description:
    'The official WordPress Builder for ZEIT Now. Deploy WordPress applications with ease.'
}

<Tag>Status: Beta</Tag>

The `@now/wordpress` Builder takes in a `wp-config.php` file as an entry point, installs [WordPress](https://wordpress.org/download/), and outputs the result as a [Lambda](/docs/v2/deployments/concepts/lambdas).

## When to Use It

Whenever you want to quickly create a Wordpress site.

### How to Use It

Define these two files within a folder like so:

- `ca.pem` - A source file that contains the database hosting CA certificate for securely connecting to a hosted MySQL database.
- `wp-config.php` - A configuration file for Wordpress.

Define the `ca.pem` source file by copying the contents of your [SSL CA certificate](https://en.wikipedia.org/wiki/Certificate_authority) from your MySQL cloud hosting provider to the file. Ensure you pick a database location that matches a Now deployment region.

Define the `wp-config.php` source file by adding the code below to it:

```php
<?php
/**
 * The base configuration for WordPress
 *
 * The wp-config.php creation script uses this file during the
 * installation. You don't have to use the web site, you can
 * copy this file to "wp-config.php" and fill in the values.
 *
 * This file contains the following configurations:
 *
 * * MySQL settings
 * * Secret keys
 * * Database table prefix
 * * ABSPATH
 *
 * @link https://codex.wordpress.org/Editing_wp-config.php
 *
 * @package WordPress
 */
// ** MySQL settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define('DB_NAME', $_ENV['DB_NAME']);
/** MySQL database username */
define('DB_USER', $_ENV['DB_USER']);
/** MySQL database password */
define('DB_PASSWORD', $_ENV['DB_PASSWORD']);
/** MySQL hostname */
define('DB_HOST', $_ENV['DB_HOST']);
/** Database Charset to use in creating database tables. */
define('DB_CHARSET', 'utf8');
/** The Database Collate type. Don't change this if in doubt. */
define('DB_COLLATE', '');
/**#@+
 * Authentication Unique Keys and Salts.
 *
 * Change these to different unique phrases!
 * You can generate these using the {@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service}
 * You can change these at any point in time to invalidate all existing cookies. This will force all users to have to log in again.
 *
 * @since 2.6.0
 */
define('AUTH_KEY',         'abracadabra');
define('SECURE_AUTH_KEY',  'abracadabra');
define('LOGGED_IN_KEY',    'abracadabra');
define('NONCE_KEY',        'abracadabra');
define('AUTH_SALT',        'abracadabra');
define('SECURE_AUTH_SALT', 'abracadabra');
define('LOGGED_IN_SALT',   'abracadabra');
define('NONCE_SALT',       'abracadabra');
/**#@-*/
/**
 * WordPress Database Table prefix.
 *
 * You can have multiple installations in one database if you give each
 * a unique prefix. Only numbers, letters, and underscores please!
 */
$table_prefix  = 'wp_';
/**
 * For developers: WordPress debugging mode.
 *
 * Change this to true to enable the display of notices during development.
 * It is strongly recommended that plugin and theme developers use WP_DEBUG
 * in their development environments.
 *
 * For information on other constants that can be used for debugging,
 * visit the Codex.
 *
 * @link https://codex.wordpress.org/Debugging_in_WordPress
 */
define('WP_DEBUG', false);
define( 'WP_SITEURL', 'https://' . $_SERVER['HTTP_HOST'] );
define( 'WP_HOME', 'https://' . $_SERVER['HTTP_HOST'] );
define( 'WP_CONTENT_URL', 'https://' . $_SERVER['HTTP_HOST'] . '/wp-content' );
/* That's all, stop editing! Happy blogging. */
/** Absolute path to the WordPress directory. */
if ( !defined('ABSPATH') )
    define('ABSPATH', dirname(__FILE__) . '/');
define( 'MYSQL_SSL_CA', ABSPATH . 'ca.pem' );
define( 'MYSQL_CLIENT_FLAGS', MYSQLI_CLIENT_SSL );
/** Sets up WordPress vars and included files. */
require_once(ABSPATH . 'wp-settings.php');
```

<Caption>
  A <InlineCode>wp-config.php</InlineCode> file defining the{' '}
  <GenericLink href="https://codex.wordpress.org/Editing_wp-config.php">
    WordPress config
  </GenericLink>{' '}
</Caption>

<Note>
  Don't forget to change the{' '}
  <GenericLink href="https://api.wordpress.org/secret-key/1.1/salt/">
    salts and keys
  </GenericLink>{' '}
  to different unique phrases.
</Note>

And finally, define a `now.json` like so:

```json
{
  "version": 2,
  "builds": [{ "src": "wp-config.php", "use": "@now/wordpress" }],
  "routes": [
    { "src": "/wp-admin/?", "dest": "index.php" },
    { "src": ".*\\.php$", "dest": "index.php" }
  ],
  "env": {
    "DB_NAME": "@wordpress_db_name",
    "DB_USER": "@wordpress_db_user",
    "DB_PASSWORD": "@wordpress_db_password",
    "DB_HOST": "@wordpress_db_host"
  }
}
```

<Caption>
  A <InlineCode>now.json</InlineCode> file defining the{' '}
  <GenericLink href="/docs/v2/platform/overview#versioning">
    Now platform version
  </GenericLink>{' '}
  and a build step using the <InlineCode>@now/wordpress</InlineCode> Builder.
</Caption>

<Note>
  Don't forget to add <InlineCode>wordpress_db_name</InlineCode>,{' '}
  <InlineCode>wordpress_db_user</InlineCode>,
  <InlineCode>wordpress_db_password</InlineCode>, and{' '}
  <InlineCode>wordpress_db_host</InlineCode> as{' '}
  <GenericLink href="/docs/v2/deployments/environment-variables-and-secrets/#securing-environment-variables-using-secrets">
    secrets with Now
  </GenericLink>{' '}
  to your deployment.
</Note>

After running `now`, you'll get a URL like this: https://wordpress-8yvrab9k2.now.sh/

## Technical Details

### Entrypoint

The entry point must always be a `wp-config.php` source file.

### WordPress Version

The latest version of WordPress is fetched from: https://wordpress.org/

### Maximum Lambda Bundle Size

To help keep cold boot times low, the [maximum output bundle size](/docs/v2/deployments/concepts/lambdas#maximum-bundle-size) for a Wordpress lambda is, by default, **`20mb`**.

This [limit is extendable](/docs/v2/deployments/builders/overview#configuring-output-lambda-size) up to **`50mb`**.

<Example>
  <span>
    Example <InlineCode>maxLambdaSize</InlineCode> configuration:
  </span>
  <Code lang="json">{`{
  "builds": [
    { "src": "wp-config.php", "use": "@now/wordpress", "config": { "maxLambdaSize": "25mb" } }
  ]
}`}</Code>
</Example>

## Resources

The goal of the ZEIT Docs is to provide you with all the information you need to easily deploy your projects. The following resources can also help you set up other projects:

<Card
  title="Guide: Deploy Hugo with Now"
  href="/guides/deploying-hugo-with-now/"
>
  Learn how to setup and deploy a Hugo project with Now and add caching headers
  to it.
</Card>

<Card
  title="Guide: Deploy Apollo Server with Now"
  href="/guides/deploying-apolloserver-to-now"
>
  Learn how to setup and deploy an Apollo GraphQL server with Now.
</Card>

<Card
  title="Guide: Deploy Gatsby with Now"
  href="/guides/deploying-gatsby-with-now"
>
  Setup and deploy a Gatsby project with Now with caching headers for extra
  speed.
</Card>

<Card title="Document: Builds Overview" href="/docs/v2/deployments/builds/">
  Learn all about build steps and what you can achieve with your Now-deployed
  projects.
</Card>

<Card title="Document: Deployment Overview" href="/docs/v2/deployments/basics/">
  Discover the deployment basics of Now.
</Card>

export default ({ children }) => <Doc meta={meta}>{children}</Doc>
